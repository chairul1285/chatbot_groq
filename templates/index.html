<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Chatbot Dukcapil</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/static/css/stylecb.css"/>
  <link rel="stylesheet" href="/static/css/stylelanding.css"/>
  <link rel="stylesheet" href="/static/css/responsive.css"/>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Font Awesome -->
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f4f4f4;
      color: #333;
    }

    .msger {
      width: 100%;
      max-width: 600px;
      height: 100vh;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      background: #fff;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }

    .centered-header {
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgb(20, 3, 252);
      padding: 15px;
      flex-direction: column;
    }

    .logo-circle {
      background-color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 60px;
      height: 60px;
      overflow: hidden;
    }

    .logo-circle img {
      width: 60px;
      height: auto;
    }

    .msger-controls {
      padding: 5px 10px;
      background: #f0f0f0;
      border-bottom: 1px solid #ddd;
    }

    .msger-controls label {
      font-size: 0.8em;
      margin-right: 5px;
    }

    .msger-controls select {
      font-size: 0.8em;
      padding: 3px;
    }

    .msger-chat {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
    }

    .msg {
      margin-bottom: 10px;
      display: flex;
      align-items: flex-start;
    }

    .msg.right-msg {
      flex-direction: row-reverse;
    }

    .msg .msg-img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 10px;
      flex-shrink: 0;
    }

    .msg .msg-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .msg-bubble {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 10px;
      background-color: #e6f4ea;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow-wrap: break-word;
      word-break: break-word;
    }

    .msg.right-msg .msg-bubble {
      background-color: #d2e3fc;
    }

    .msg-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.7em;
      color: #666;
      margin-bottom: 3px;
    }

    .msg-text {
      font-size: var(--chat-font-size, 0.85em);
      color: #333;
    }

    .msger-inputarea {
      display: flex;
      padding: 10px;
      background: #fff;
      border-top: 1px solid #ddd;
    }

    .msger-input {
      flex: 1;
      padding: 8px;
      font-size: 0.9em;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-right: 8px;
    }

    .msger-send-btn {
      padding: 8px 16px;
      background: rgb(20, 3, 252);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .msger-send-btn:hover {
      background: rgb(15, 2, 200);
    }
  </style>
</head>

<body>
  <!-- Chatbox -->
  <section class="msger">
    <header class="msger-header centered-header">
      <div class="logo-circle">
        <img src="../static/img/LOGO_ROJO1.png" alt="RoJO Logo" />
      </div>
    </header>

    <div class="msger-controls">
      <label for="fontSizeSelect">Ukuran Font:</label>
      <select id="fontSizeSelect">
        <option value="0.7em">Cilik</option>
        <option value="0.85em" selected>Normal</option>
        <option value="1em">Besar</option>
        <option value="1.2em">Sangat Besar</option>
      </select>
    </div>

    <main class="msger-chat"></main>

    <form class="msger-inputarea" id="chatForm">
      <input type="text" class="msger-input" id="textInput" placeholder="Ketikkan sesuatu..." required />
      <button type="submit" class="msger-send-btn">Kirim</button>
    </form>
  </section>

  <!-- Script -->
  <script>
    const msgerForm = document.querySelector("#chatForm");
    const msgerInput = document.querySelector("#textInput");
    const msgerChat = document.querySelector(".msger-chat");
    const fontSizeSelect = document.querySelector("#fontSizeSelect");

    const BOT_IMG = "../static/img/LOGO_ROJO.png";
    const PERSON_IMG = "../static/img/ping.png";
    const BOT_NAME = "DUKCAPIL menjawab";
    const PERSON_NAME = "Anda";

    msgerForm.addEventListener("submit", event => {
      event.preventDefault();
      const msgText = msgerInput.value;
      if (!msgText) return;
      appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      botResponse(msgText);
    });

    function appendMessage(name, img, side, text) {
      const msgHTML = `
        <div class="msg ${side}-msg">
          <div class="msg-img"><img src="${img}" alt="${name}" /></div>
          <div class="msg-bubble">
            <div class="msg-info">
              <div class="msg-info-name">${name}</div>
              <div class="msg-info-time">${formatDate(new Date())}</div>
            </div>
            <div class="msg-text">${text}</div>
          </div>
        </div>
      `;
      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop = msgerChat.scrollHeight;
    }

    function botResponse(rawText) {
      fetch('/get', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ 'msg': rawText })
      })
        .then(response => response.text())
        .then(data => {
          appendMessage(BOT_NAME, BOT_IMG, "left", data);
        })
        .catch(error => console.error('Error:', error));
    }

    function formatDate(date) {
      const h = "0" + date.getHours();
      const m = "0" + date.getMinutes();
      return `${h.slice(-2)}:${m.slice(-2)}`;
    }

    fontSizeSelect.addEventListener("change", () => {
      const size = fontSizeSelect.value;
      document.documentElement.style.setProperty('--chat-font-size', size);
    });

    // Set default font size
    document.documentElement.style.setProperty('--chat-font-size', fontSizeSelect.value);
  </script>
</body>
</html>
